{# app/templates/components/theme_toggle.html #}
<button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle theme">
  <span class="theme-icon" aria-hidden="true">‚óè</span>
</button>
<script>
  (function () {
    var key = "{{ config['THEME_COOKIE_NAME'] }}";
    var btn = document.getElementById('theme-toggle');
    if (!btn) return;

    function getCookie(name) {
      var m = document.cookie.match('(?:^|; )' + name.replace(/([$?*|{}\]\\^])/g, '\\$1') + '=([^;]*)');
      return m ? decodeURIComponent(m[1]) : '';
    }
    function setCookie(name, value, days) {
      var d = new Date();
      d.setTime(d.getTime() + (days*24*60*60*1000));
      document.cookie = name + '=' + encodeURIComponent(value) + ';expires=' + d.toUTCString() + ';path=/;samesite=Lax;secure';
    }
    function apply(theme) {
      var t = theme || 'auto';
      if (t === 'auto') {
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.dataset.theme = prefersDark ? 'dark' : 'light';
      } else {
        document.documentElement.dataset.theme = t;
      }
    }

    apply(getCookie(key) || 'auto');
    btn.addEventListener('click', function () {
      var curr = getCookie(key) || 'auto';
      var next = (curr === 'light') ? 'dark' : (curr === 'dark' ? 'auto' : 'light');
      setCookie(key, next, {{ (config['THEME_COOKIE_MAX_AGE'] // 86400) | int }});
      apply(next);
    });
  }());
</script>
